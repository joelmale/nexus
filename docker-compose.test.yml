version: '3.8'

# Test Docker Compose configuration
# Run tests with: docker-compose -f docker-compose.test.yml run test

services:
  test:
    image: node:20-alpine
    working_dir: /app
    command: sh -c "npm install && npm run test:all"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - NODE_ENV=test
      - CI=true
    networks:
      - nexus-test
    depends_on:
      - redis-test
      - backend-test

  backend-test:
    image: node:20-alpine
    working_dir: /app
    command: sh -c "npm install && npm run server:test"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - NODE_ENV=test
      - PORT=5000
      - REDIS_URL=redis://redis-test:6379
      - JWT_SECRET=test-secret
    networks:
      - nexus-test
    depends_on:
      - redis-test

  redis-test:
    image: redis:7-alpine
    command: redis-server --save ""
    networks:
      - nexus-test

networks:
  nexus-test:
    driver: bridge
